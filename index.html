<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adaptive Learning AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                'Inter',
                'system-ui',
                '-apple-system',
                'BlinkMacSystemFont',
                'Segoe UI',
                'sans-serif',
              ],
            },
          },
        },
      };
    </script>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background-color: #f8fafc;
      }

      #root {
        min-height: 100vh;
      }

      .markdown-content {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        color: #374151;
        line-height: 1.75;
      }

      .markdown-content h1 {
        font-size: 1.875rem;
        font-weight: 700;
        color: #1f2937;
      }

      .markdown-content h2 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937;
        margin-top: 1.5rem;
      }

      .markdown-content h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-top: 1rem;
      }

      .markdown-content p {
        margin: 0;
        font-size: 1rem;
      }

      .markdown-content ul,
      .markdown-content ol {
        padding-left: 1.5rem;
        margin: 0;
      }

      .markdown-content ul {
        list-style-type: disc;
      }

      .markdown-content ol {
        list-style-type: decimal;
      }

      .markdown-content li {
        margin-bottom: 0.5rem;
      }

      .markdown-content code {
        padding: 0.25rem 0.4rem;
        border-radius: 0.375rem;
        background-color: #f1f5f9;
        font-family: 'Fira Code', 'SFMono-Regular', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono',
          'Courier New', monospace;
        font-size: 0.875rem;
        color: #334155;
      }

      .markdown-content pre {
        background-color: #0f172a;
        color: #f8fafc;
        padding: 1rem;
        border-radius: 0.75rem;
        overflow-x: auto;
        font-size: 0.875rem;
      }

      .markdown-content pre code {
        background-color: transparent;
        color: inherit;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="root" class="min-h-screen"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useCallback, useMemo, useState, useEffect } = React;

      const ANTHROPIC_API_URL = 'https://api.anthropic.com/v1/messages';
      const DEFAULT_MODEL = 'claude-3-5-sonnet-20240620';

      const learningStylesDefinition = [
        {
          id: 'visual',
          name: 'Visual',
          icon: 'ðŸ‘ï¸',
          description: 'Diagrams, examples, and visual explanations',
        },
        {
          id: 'practical',
          name: 'Practical',
          icon: 'ðŸ› ï¸',
          description: 'Hands-on exercises and real-world applications',
        },
        {
          id: 'theoretical',
          name: 'Theoretical',
          icon: 'ðŸ“š',
          description: 'Deep concepts and theoretical foundations',
        },
        {
          id: 'balanced',
          name: 'Balanced',
          icon: 'âš–ï¸',
          description: 'Mix of theory, examples, and practice',
        },
      ];

      const skillLevelsDefinition = [
        { id: 'beginner', name: 'Beginner', description: 'New to this topic' },
        { id: 'intermediate', name: 'Intermediate', description: 'Some familiarity' },
        { id: 'advanced', name: 'Advanced', description: 'Strong foundation' },
      ];

      const inferStyleInstruction = (learningStyle) => {
        switch (learningStyle) {
          case 'visual':
            return 'use concrete examples and analogies';
          case 'practical':
            return 'focus on real-world applications and how to use this knowledge';
          case 'theoretical':
            return 'explain underlying principles and concepts deeply';
          default:
            return 'balance theory with practical examples';
        }
      };

      const createAnthropicHeaders = (apiKey) => ({
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
      });

      const MarkdownRenderer = ({ content }) => {
        if (!content) {
          return null;
        }

        const lines = content.split('\n');
        const elements = [];

        const processBold = (text, startKey = 0) => {
          const parts = [];
          const boldRegex = /(\*\*|__)(.*?)\1/g;
          let lastIndex = 0;
          let match;
          let key = startKey;

          while ((match = boldRegex.exec(text)) !== null) {
            if (match.index > lastIndex) {
              parts.push(text.substring(lastIndex, match.index));
            }
            parts.push(
              <strong key={`bold-${key++}`} className="font-semibold">
                {match[2]}
              </strong>,
            );
            lastIndex = match.index + match[0].length;
          }

          if (lastIndex < text.length) {
            parts.push(text.substring(lastIndex));
          }

          return parts.length > 0 ? parts : [text];
        };

        const processInlineMarkdown = (text) => {
          const inlineCodeRegex = /`([^`]+)`/g;
          const parts = [];
          let lastIndex = 0;
          let match;
          let key = 0;

          while ((match = inlineCodeRegex.exec(text)) !== null) {
            if (match.index > lastIndex) {
              const beforeText = text.substring(lastIndex, match.index);
              parts.push(...processBold(beforeText, key++));
            }
            parts.push(
              <code key={`code-${key++}`} className="bg-gray-100 px-2 py-0.5 rounded text-sm font-mono text-purple-700">
                {match[1]}
              </code>,
            );
            lastIndex = match.index + match[0].length;
          }

          if (lastIndex < text.length) {
            const remainingText = text.substring(lastIndex);
            parts.push(...processBold(remainingText, key++));
          }

          return parts.length > 0 ? parts : text;
        };

        let i = 0;
        while (i < lines.length) {
          const line = lines[i];
          const trimmedLine = line.trim();

          if (trimmedLine.startsWith('```')) {
            const language = trimmedLine.substring(3).trim();
            const codeLines = [];
            i += 1;

            while (i < lines.length && !lines[i].trim().startsWith('```')) {
              codeLines.push(lines[i]);
              i += 1;
            }

            elements.push(
              <div key={`code-block-${elements.length}`} className="mb-4">
                {language && (
                  <div className="bg-gray-700 text-gray-300 text-xs px-4 py-2 rounded-t-lg font-mono">{language}</div>
                )}
                <pre className={`bg-gray-800 text-gray-100 p-4 ${language ? 'rounded-b-lg' : 'rounded-lg'} overflow-x-auto`}>
                  <code className="text-sm font-mono">{codeLines.join('\n')}</code>
                </pre>
              </div>,
            );
            i += 1;
            continue;
          }

          if (trimmedLine.startsWith('###')) {
            elements.push(
              <h3 key={`h3-${elements.length}`} className="text-lg font-semibold text-gray-800 mt-6 mb-3">
                {processInlineMarkdown(trimmedLine.replace(/^###\s*/, ''))}
              </h3>,
            );
          } else if (trimmedLine.startsWith('##')) {
            elements.push(
              <h2 key={`h2-${elements.length}`} className="text-xl font-semibold text-gray-800 mt-6 mb-3">
                {processInlineMarkdown(trimmedLine.replace(/^##\s*/, ''))}
              </h2>,
            );
          } else if (trimmedLine.startsWith('#')) {
            elements.push(
              <h1 key={`h1-${elements.length}`} className="text-2xl font-semibold text-gray-800 mt-6 mb-4">
                {processInlineMarkdown(trimmedLine.replace(/^#\s*/, ''))}
              </h1>,
            );
          } else if (/^[-*â€¢]\s/.test(trimmedLine)) {
            const listItems = [];
            while (i < lines.length && /^[-*â€¢]\s/.test(lines[i].trim())) {
              listItems.push(lines[i].trim().replace(/^[-*â€¢]\s/, ''));
              i += 1;
            }
            elements.push(
              <ul key={`list-${elements.length}`} className="list-disc pl-6 mb-4 space-y-2">
                {listItems.map((item, idx) => (
                  <li key={idx} className="text-gray-700">
                    {processInlineMarkdown(item)}
                  </li>
                ))}
              </ul>,
            );
            continue;
          } else if (/^\d+\.\s/.test(trimmedLine)) {
            const listItems = [];
            while (i < lines.length && /^\d+\.\s/.test(lines[i].trim())) {
              listItems.push(lines[i].trim().replace(/^\d+\.\s/, ''));
              i += 1;
            }
            elements.push(
              <ol key={`olist-${elements.length}`} className="list-decimal pl-6 mb-4 space-y-2">
                {listItems.map((item, idx) => (
                  <li key={idx} className="text-gray-700">
                    {processInlineMarkdown(item)}
                  </li>
                ))}
              </ol>,
            );
            continue;
          } else if (trimmedLine === '') {
            elements.push(<div key={`space-${elements.length}`} className="h-4" />);
          } else if (trimmedLine.length > 0) {
            elements.push(
              <p key={`p-${elements.length}`} className="text-gray-700 mb-4 leading-relaxed">
                {processInlineMarkdown(trimmedLine)}
              </p>,
            );
          }

          i += 1;
        }

        return <div>{elements}</div>;
      };

      const AdaptiveLearningPlatform = () => {
        const [screen, setScreen] = useState('setup');
        const [subject, setSubject] = useState('');
        const [skillLevel, setSkillLevel] = useState('beginner');
        const [learningStyle, setLearningStyle] = useState('balanced');
        const [currentLesson, setCurrentLesson] = useState(null);
        const [lessonHistory, setLessonHistory] = useState([]);
        const [quizData, setQuizData] = useState(null);
        const [userAnswer, setUserAnswer] = useState('');
        const [loading, setLoading] = useState(false);
        const [progress, setProgress] = useState(0);
        const [apiKey, setApiKey] = useState(() => localStorage.getItem('anthropicApiKey') || '');
        const [model, setModel] = useState(() => localStorage.getItem('anthropicModel') || DEFAULT_MODEL);

        useEffect(() => {
          if (apiKey) {
            localStorage.setItem('anthropicApiKey', apiKey);
          } else {
            localStorage.removeItem('anthropicApiKey');
          }
        }, [apiKey]);

        useEffect(() => {
          if (model && model !== DEFAULT_MODEL) {
            localStorage.setItem('anthropicModel', model);
          } else {
            localStorage.removeItem('anthropicModel');
          }
        }, [model]);

        const learningStyles = useMemo(() => learningStylesDefinition, []);
        const skillLevels = useMemo(() => skillLevelsDefinition, []);

        const generateLesson = useCallback(async () => {
          if (!apiKey) {
            alert('Please enter your Anthropic API key before generating a lesson.');
            return;
          }

          if (!subject.trim()) {
            alert('Please enter a subject to study.');
            return;
          }

          try {
            setLoading(true);
            const lessonNumber = lessonHistory.length + 1;
            const previousContext =
              lessonHistory.length > 0
                ? `\n\nPrevious lessons covered: ${lessonHistory
                    .map((lesson, index) => `Lesson ${index + 1}: ${lesson.title}`)
                    .join(', ')}`
                : '';

            const prompt = `You are an expert educational AI creating lesson ${lessonNumber} about "${subject}".

Student Profile:
- Skill Level: ${skillLevel}
- Learning Style: ${learningStyle}
- Progress: ${lessonHistory.length} lessons completed${previousContext}

Create an engaging, ${skillLevel}-appropriate lesson. Structure your response EXACTLY as follows:

LESSON_TITLE: [A clear, engaging title]

INTRODUCTION:
[2-3 sentences introducing the topic in an engaging way]

MAIN_CONTENT:
[The core lesson content. For ${learningStyle} learners, ${inferStyleInstruction(learningStyle)}. Use clear sections and formatting. Make it substantive but digestible.]

KEY_TAKEAWAYS:
[3-5 bullet points of the most important concepts]

PRACTICE_HINT:
[A brief hint about what kind of practice question will follow]

Keep the tone encouraging and enthusiastic. Adjust complexity for ${skillLevel} level.`;

            const response = await fetch(ANTHROPIC_API_URL, {
              method: 'POST',
              headers: createAnthropicHeaders(apiKey),
              body: JSON.stringify({
                model: model || DEFAULT_MODEL,
                max_tokens: 2000,
                messages: [{ role: 'user', content: prompt }],
              }),
            });

            if (!response.ok) {
              throw new Error(`Anthropic API returned ${response.status}`);
            }

            const data = await response.json();
            const lessonText = data?.content?.[0]?.text || '';

            const titleMatch = lessonText.match(/LESSON_TITLE:\s*(.+)/);
            const introMatch = lessonText.match(/INTRODUCTION:\s*([\s\S]+?)(?=MAIN_CONTENT:)/);
            const contentMatch = lessonText.match(/MAIN_CONTENT:\s*([\s\S]+?)(?=KEY_TAKEAWAYS:)/);
            const takeawaysMatch = lessonText.match(/KEY_TAKEAWAYS:\s*([\s\S]+?)(?=PRACTICE_HINT:|$)/);

            const lesson = {
              title: titleMatch ? titleMatch[1].trim() : `Lesson ${lessonNumber}: ${subject}`,
              introduction: introMatch ? introMatch[1].trim() : '',
              content: contentMatch ? contentMatch[1].trim() : lessonText,
              takeaways: takeawaysMatch ? takeawaysMatch[1].trim() : '',
              timestamp: new Date().toISOString(),
            };

            setCurrentLesson(lesson);
            setScreen('learning');
          } catch (error) {
            console.error('Error generating lesson:', error);
            alert('Failed to generate lesson. Please verify your API key and network connection, then try again.');
          } finally {
            setLoading(false);
          }
        }, [apiKey, lessonHistory, learningStyle, model, skillLevel, subject]);

        const generateQuiz = useCallback(async () => {
          if (!apiKey) {
            alert('Please enter your Anthropic API key before generating a quiz.');
            return;
          }

          if (!currentLesson) {
            return;
          }

          try {
            setLoading(true);
            const prompt = `Based on the lesson titled "${currentLesson.title}" about ${subject}, create ONE ${skillLevel}-level quiz question.

Respond ONLY with valid JSON in this exact format (no other text, no backticks):
{
  "question": "The quiz question text",
  "type": "multiple-choice",
  "options": ["Option A", "Option B", "Option C", "Option D"],
  "correctAnswer": "The exact text of the correct option",
  "explanation": "Why this answer is correct and what it demonstrates"
}

Make the question test understanding, not just memorization. Keep it relevant to ${skillLevel} level.`;

            const response = await fetch(ANTHROPIC_API_URL, {
              method: 'POST',
              headers: createAnthropicHeaders(apiKey),
              body: JSON.stringify({
                model: model || DEFAULT_MODEL,
                max_tokens: 800,
                messages: [{ role: 'user', content: prompt }],
              }),
            });

            if (!response.ok) {
              throw new Error(`Anthropic API returned ${response.status}`);
            }

            const data = await response.json();
            let responseText = data?.content?.[0]?.text || '';
            responseText = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

            const quiz = JSON.parse(responseText);
            setQuizData(quiz);
            setScreen('quiz');
          } catch (error) {
            console.error('Error generating quiz:', error);
            alert('Failed to generate quiz. Please verify your API key and try again.');
          } finally {
            setLoading(false);
          }
        }, [apiKey, currentLesson, model, skillLevel, subject]);

        const submitQuiz = useCallback(() => {
          if (!userAnswer) {
            alert('Please select an answer');
            return;
          }

          const isCorrect = userAnswer === quizData?.correctAnswer;
          const newProgress = Math.min(100, progress + (isCorrect ? 15 : 5));
          setProgress(newProgress);

          setLessonHistory((history) => [
            ...history,
            {
              ...currentLesson,
              quizResult: isCorrect ? 'correct' : 'incorrect',
            },
          ]);

          setScreen('complete');
        }, [currentLesson, progress, quizData?.correctAnswer, userAnswer]);

        const restartPlatform = useCallback(() => {
          setScreen('setup');
          setSubject('');
          setSkillLevel('beginner');
          setLearningStyle('balanced');
          setCurrentLesson(null);
          setLessonHistory([]);
          setQuizData(null);
          setUserAnswer('');
          setProgress(0);
        }, []);

        const startNewLesson = useCallback(() => {
          setCurrentLesson(null);
          setQuizData(null);
          setUserAnswer('');
          generateLesson();
        }, [generateLesson]);

        if (screen === 'setup') {
          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6">
              <div className="max-w-3xl mx-auto">
                <div className="text-center mb-8 mt-8">
                  <div className="flex items-center justify-center mb-4">
                    <div className="w-16 h-16 rounded-full bg-white shadow flex items-center justify-center text-4xl">ðŸ§ </div>
                  </div>
                  <h1 className="text-4xl font-bold text-gray-800 mb-2">Adaptive Learning AI</h1>
                  <p className="text-gray-600">Personalized lessons that adapt to your style and pace</p>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-8 space-y-6">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Anthropic API Key</label>
                    <input
                      type="password"
                      value={apiKey}
                      onChange={(event) => setApiKey(event.target.value.trim())}
                      placeholder="sk-ant-..."
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                    />
                    <p className="text-xs text-gray-500 mt-2">
                      Your key is stored locally in this browser so you only need to enter it once.
                    </p>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Anthropic Model (optional)</label>
                    <input
                      type="text"
                      value={model}
                      onChange={(event) => setModel(event.target.value)}
                      placeholder={DEFAULT_MODEL}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                    />
                    <p className="text-xs text-gray-500 mt-2">
                      Leave blank to use <code>{DEFAULT_MODEL}</code>.
                    </p>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">What do you want to learn?</label>
                    <input
                      type="text"
                      value={subject}
                      onChange={(event) => setSubject(event.target.value)}
                      placeholder="e.g., Quantum Physics, French Cooking, Machine Learning..."
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:outline-none"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-3">Your skill level</label>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                      {skillLevels.map((level) => (
                        <button
                          key={level.id}
                          type="button"
                          onClick={() => setSkillLevel(level.id)}
                          className={`p-4 rounded-lg border-2 transition-all ${
                            skillLevel === level.id
                              ? 'border-purple-500 bg-purple-50'
                              : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="font-semibold text-gray-800">{level.name}</div>
                          <div className="text-xs text-gray-600 mt-1">{level.description}</div>
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-3">Learning style</label>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                      {learningStyles.map((style) => (
                        <button
                          key={style.id}
                          type="button"
                          onClick={() => setLearningStyle(style.id)}
                          className={`p-4 rounded-lg border-2 transition-all text-left ${
                            learningStyle === style.id
                              ? 'border-purple-500 bg-purple-50'
                              : 'border-gray-200 hover:border-gray-300'
                          }`}
                        >
                          <div className="flex items-center mb-1">
                            <span className="text-2xl mr-2">{style.icon}</span>
                            <span className="font-semibold text-gray-800">{style.name}</span>
                          </div>
                          <div className="text-xs text-gray-600">{style.description}</div>
                        </button>
                      ))}
                    </div>
                  </div>

                  <button
                    type="button"
                    onClick={generateLesson}
                    disabled={!subject || !apiKey || loading}
                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
                  >
                    {loading ? (
                      <>
                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2" />
                        Crafting your first lesson...
                      </>
                    ) : (
                      <>
                        <span className="mr-2">âœ¨</span>
                        Start Learning
                      </>
                    )}
                  </button>
                </div>
              </div>
            </div>
          );
        }

        if (screen === 'learning' && currentLesson) {
          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6">
              <div className="max-w-4xl mx-auto">
                <div className="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                  <div>
                    <div className="text-sm text-gray-600 mb-1">Lesson {lessonHistory.length + 1}</div>
                    <h2 className="text-3xl font-bold text-gray-800">{currentLesson.title}</h2>
                  </div>
                  <div className="text-right">
                    <div className="text-sm text-gray-600 mb-1">Progress</div>
                    <div className="text-2xl font-bold text-purple-600">{progress}%</div>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                  {currentLesson.introduction && (
                    <div className="mb-6 p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                      <p className="text-gray-700 leading-relaxed">{currentLesson.introduction}</p>
                    </div>
                  )}

                  <div className="markdown-content mb-6">
                    <MarkdownRenderer content={currentLesson.content} />
                  </div>

                  {currentLesson.takeaways && (
                    <div className="mt-6 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg">
                      <div className="flex items-center mb-3">
                        <span className="text-xl mr-2">ðŸŽ¯</span>
                        <h3 className="font-semibold text-gray-800">Key Takeaways</h3>
                      </div>
                      <MarkdownRenderer content={currentLesson.takeaways} />
                    </div>
                  )}
                </div>

                <div className="flex flex-col sm:flex-row gap-4">
                  <button
                    type="button"
                    onClick={restartPlatform}
                    className="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:border-gray-400 transition-all"
                  >
                    Choose Different Topic
                  </button>
                  <button
                    type="button"
                    onClick={generateQuiz}
                    disabled={loading}
                    className="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 flex items-center justify-center"
                  >
                    {loading ? (
                      <>
                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2" />
                        Preparing practice...
                      </>
                    ) : (
                      <>
                        Continue to Practice
                        <span className="ml-2">â†’</span>
                      </>
                    )}
                  </button>
                </div>
              </div>
            </div>
          );
        }

        if (screen === 'quiz' && quizData) {
          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6">
              <div className="max-w-3xl mx-auto">
                <div className="mb-6">
                  <div className="text-sm text-gray-600 mb-1">Practice Question</div>
                  <h2 className="text-3xl font-bold text-gray-800">Test Your Understanding</h2>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-8">
                  <div className="mb-6">
                    <div className="flex items-start mb-4">
                      <span className="text-2xl mr-3 mt-1 flex-shrink-0">âš¡</span>
                      <p className="text-lg text-gray-800 font-medium">{quizData.question}</p>
                    </div>
                  </div>

                  <div className="space-y-3 mb-6">
                    {quizData.options.map((option, index) => (
                      <button
                        key={index}
                        type="button"
                        onClick={() => setUserAnswer(option)}
                        className={`w-full p-4 rounded-lg border-2 text-left transition-all ${
                          userAnswer === option
                            ? 'border-purple-500 bg-purple-50'
                            : 'border-gray-200 hover:border-gray-300'
                        }`}
                      >
                        <div className="flex items-center">
                          <div
                            className={`w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center ${
                              userAnswer === option ? 'border-purple-500 bg-purple-500 text-white' : 'border-gray-300'
                            }`}
                          >
                            {userAnswer === option && 'âœ“'}
                          </div>
                          <span className="text-gray-800">{option}</span>
                        </div>
                      </button>
                    ))}
                  </div>

                  <button
                    type="button"
                    onClick={submitQuiz}
                    disabled={!userAnswer}
                    className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    Submit Answer
                  </button>
                </div>
              </div>
            </div>
          );
        }

        if (screen === 'complete' && quizData) {
          const isCorrect = userAnswer === quizData.correctAnswer;

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6">
              <div className="max-w-3xl mx-auto">
                <div
                  className={`mb-6 p-6 rounded-2xl ${
                    isCorrect ? 'bg-green-100 border-2 border-green-300' : 'bg-yellow-100 border-2 border-yellow-300'
                  }`}
                >
                  <div className="text-center">
                    <div className="text-4xl mb-2">{isCorrect ? 'ðŸŽ‰' : 'ðŸ’¡'}</div>
                    <h2 className="text-2xl font-bold text-gray-800 mb-2">{isCorrect ? 'Excellent!' : 'Good Try!'}</h2>
                    <p className="text-gray-700">
                      {isCorrect
                        ? 'You nailed it! Your understanding is growing.'
                        : "Learning is a journey. Let's review what we learned."}
                    </p>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-8 mb-6">
                  <h3 className="font-semibold text-gray-800 mb-3">The Question</h3>
                  <p className="text-gray-700 mb-4">{quizData.question}</p>

                  <div className="mb-4">
                    <div className="text-sm font-semibold text-gray-600 mb-2">Your Answer:</div>
                    <div
                      className={`p-3 rounded-lg ${
                        isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'
                      }`}
                    >
                      {userAnswer}
                    </div>
                  </div>

                  {!isCorrect && (
                    <div className="mb-4">
                      <div className="text-sm font-semibold text-gray-600 mb-2">Correct Answer:</div>
                      <div className="p-3 rounded-lg bg-green-50 border border-green-200">{quizData.correctAnswer}</div>
                    </div>
                  )}

                  <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                    <div className="text-sm font-semibold text-gray-800 mb-2">ðŸ’¡ Explanation</div>
                    <p className="text-gray-700">{quizData.explanation}</p>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                  <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                      <div className="text-sm text-gray-600">Lessons Completed</div>
                      <div className="text-2xl font-bold text-gray-800">{lessonHistory.length}</div>
                    </div>
                    <div>
                      <div className="text-sm text-gray-600">Overall Progress</div>
                      <div className="text-2xl font-bold text-purple-600">{progress}%</div>
                    </div>
                    <div>
                      <div className="text-sm text-gray-600">Current Level</div>
                      <div className="text-2xl font-bold text-gray-800 capitalize">{skillLevel}</div>
                    </div>
                  </div>
                </div>

                <div className="flex flex-col sm:flex-row gap-4">
                  <button
                    type="button"
                    onClick={restartPlatform}
                    className="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:border-gray-400 transition-all"
                  >
                    Choose New Topic
                  </button>
                  <button
                    type="button"
                    onClick={startNewLesson}
                    disabled={loading}
                    className="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 flex items-center justify-center"
                  >
                    {loading ? (
                      <>
                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2" />
                        Creating next lesson...
                      </>
                    ) : (
                      <>
                        <span className="mr-2">ðŸ“˜</span>
                        Continue Learning
                      </>
                    )}
                  </button>
                </div>
              </div>
            </div>
          );
        }

        return null;
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<AdaptiveLearningPlatform />);
    </script>
  </body>
</html>
